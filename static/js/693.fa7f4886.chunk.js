"use strict";(self.webpackChunkn0w0n_blog=self.webpackChunkn0w0n_blog||[]).push([[693],{5449:(e,t,r)=>{r.d(t,{o:()=>y});var n=r(9379),a=r(3986),s=(r(6470),r(6617),r(4319)),l=r(9950),o=r(486),i=r(152),c=r(6315),u=r(7624),d=r(1034),h=r(8992),p=r(4414);const m=["node"],f=["node"],g=["node"],v=["node"],y=e=>{let{className:t,children:r}=e;return(0,l.useEffect)((()=>(s.lX.bind("[data-viewer]"),()=>{s.lX.destroy()})),[]),(0,p.jsx)(o.o,{className:"prose text-md lg:prose-base max-w-[100%] break-words ".concat(null!==t&&void 0!==t?t:""),children:r,components:{a:e=>{let{node:t}=e,r=(0,a.A)(e,m);return(0,p.jsx)("a",(0,n.A)((0,n.A)({href:r.href,target:"_blank",rel:"noreferrer"},r),{},{children:r.children}))},img:e=>{let{node:t}=e,r=(0,a.A)(e,f);return(0,p.jsxs)("a",{className:"flex flex-col items-center",href:r.src,"data-viewer":!0,"data-caption":r.alt,children:[(0,p.jsx)("img",(0,n.A)((0,n.A)({className:"rounded-lg shadow-lg"},r),{},{alt:r.alt})),(0,p.jsx)("span",{className:"-mt-6 text-sm",children:r.alt})]})},pre:e=>{let{node:t}=e,r=(0,a.A)(e,g);return(0,p.jsx)("pre",(0,n.A)({className:"bg-transparent p-2"},r))},code:e=>{let{className:t,children:r,node:n}=e;const a=/language-(\w+)/.exec(null!==t&&void 0!==t?t:""),s=null!==a?a[1]:"",l=String(r);return a?(0,p.jsx)(h.C,{language:s,fileName:"snippet_".concat(Date.now(),".txt"),children:l}):(0,p.jsx)("code",{className:"text-gray-700 font-mono overflow-scroll bg-gray-200 px-2 py-0.5 rounded-sm",children:l.replace(/\n$/,"")})},table:e=>{let{node:t}=e,r=(0,a.A)(e,v);return(0,p.jsx)("table",(0,n.A)({className:"overflow-x-auto block whitespace-nowrap"},r))}},urlTransform:e=>e,rehypePlugins:[i.A,c.A],remarkPlugins:[u.A,d.A]})}},2105:(e,t,r)=>{r.d(t,{D:()=>a});var n=r(9699);const a=e=>{const t=new Date(e);return(0,n.A)(t,"yyyy-MM-dd HH:mm:ss")}},5693:(e,t,r)=>{r.r(t),r.d(t,{default:()=>P});var n=r(2631),a=r(4090),s=r.n(a),l=r(9379),o=function(){var e;try{if("undefined"===typeof localStorage)return!1;const e="nuqs-localStorage-test";localStorage.setItem(e,e);const t=localStorage.getItem(e)===e;if(localStorage.removeItem(e),!t)return!1}catch(t){return console.error("[nuqs]: debug mode is disabled (localStorage unavailable).",t),!1}return(null!==(e=localStorage.getItem("debug"))&&void 0!==e?e:"").includes("nuqs")}();function i(e){if(!o)return;for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];const a=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return e.replace(/%[sfdO]/g,(e=>{const t=r.shift();return"%O"===e&&t?JSON.stringify(t).replace(/"([^"]+)":/g,"$1:"):String(t)}))}(e,...r);performance.mark(a),console.log(e,...r)}var c=r(5154);function u(e,t,r){try{return e(t)}catch(n){return function(e){if(o){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];console.warn(e,...r)}}("[nuqs] Error while parsing value `%s`: %O"+(r?" (for key `%s`)":""),t,n,r),null}}var d=function(){if("undefined"===typeof window)return 50;if(!Boolean(window.GestureEvent))return 50;try{var e;const t=null===(e=navigator.userAgent)||void 0===e?void 0:e.match(/version\/([\d\.]+) safari/i);return parseFloat(t[1])>=17?120:320}catch(t){return 320}}(),h=new Map,p={history:"replace",scroll:!1,shallow:!0,throttleMs:d},m=new Set,f=0,g=null;function v(){return new URLSearchParams(location.search)}function y(e){let{getSearchParamsSnapshot:t=v,updateUrl:r,rateLimitFactor:n=1}=e;return null===g&&(g=new Promise(((e,a)=>{if(!Number.isFinite(p.throttleMs))return i("[nuqs queue] Skipping flush due to throttleMs=Infinity"),e(t()),void setTimeout((()=>{g=null}),0);function s(){f=performance.now();const[n,s]=function(e){let{updateUrl:t,getSearchParamsSnapshot:r}=e;const n=r();if(0===h.size)return[n,null];const a=Array.from(h.entries()),s=(0,l.A)({},p),o=Array.from(m);h.clear(),m.clear(),p.history="replace",p.scroll=!1,p.shallow=!0,p.throttleMs=d,i("[nuqs queue] Flushing queue %O with options %O",a,s);for(const[l,i]of a)null===i?n.delete(l):n.set(l,i);try{return function(e,t){const r=n=>{if(n===e.length)return t();const a=e[n];if(!a)throw new Error("Invalid transition function");a((()=>r(n+1)))};r(0)}(o,(()=>{t(n,{history:s.history,scroll:s.scroll,shallow:s.shallow})})),[n,null]}catch(u){return console.error((0,c.z3)(429),a.map((e=>{let[t]=e;return t})).join(),u),[n,u]}}({updateUrl:r,getSearchParamsSnapshot:t});null===s?e(n):a(n),g=null}setTimeout((function(){const e=performance.now()-f,t=p.throttleMs,r=n*Math.max(0,Math.min(t,t-e));i("[nuqs queue] Scheduling flush in %f ms. Throttled at %f ms",r,t),0===r?s():setTimeout(s,r)}),0)}))),g}var w=r(9950),x=r(8676);function b(e){function t(t){if("undefined"===typeof t)return null;let r="";if(Array.isArray(t)){if(void 0===t[0])return null;r=t[0]}return"string"===typeof t&&(r=t),u(e.parse,r)}return(0,l.A)((0,l.A)({eq:(e,t)=>e===t},e),{},{parseServerSide:t,withDefault(e){return(0,l.A)((0,l.A)({},this),{},{defaultValue:e,parseServerSide(r){var n;return null!==(n=t(r))&&void 0!==n?n:e}})},withOptions(e){return(0,l.A)((0,l.A)({},this),e)}})}b({parse:e=>e,serialize:e=>"".concat(e)}),b({parse:e=>{const t=parseInt(e);return Number.isNaN(t)?null:t},serialize:e=>Math.round(e).toFixed()}),b({parse:e=>{const t=parseInt(e,16);return Number.isNaN(t)?null:t},serialize:e=>{const t=Math.round(e).toString(16);return t.padStart(t.length+t.length%2,"0")}}),b({parse:e=>{const t=parseFloat(e);return Number.isNaN(t)?null:t},serialize:e=>e.toString()}),b({parse:e=>"true"===e,serialize:e=>e?"true":"false"}),b({parse:e=>{const t=parseInt(e);return Number.isNaN(t)?null:new Date(t)},serialize:e=>e.valueOf().toString()}),b({parse:e=>{const t=new Date(e);return Number.isNaN(t.valueOf())?null:t},serialize:e=>e.toISOString()}),b({parse:e=>{const t=new Date(e.slice(0,10));return Number.isNaN(t.valueOf())?null:t},serialize:e=>e.toISOString().slice(0,10)});var N=(0,x.A)();function S(e){var t,r,n;let{history:a="replace",shallow:s=!0,scroll:l=!1,throttleMs:o=d,parse:f=e=>e,serialize:g=String,eq:v=(e,t)=>e===t,defaultValue:x,clearOnDefault:b=!0,startTransition:S}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{history:"replace",scroll:!1,shallow:!0,throttleMs:d,parse:e=>e,serialize:String,eq:(e,t)=>e===t,clearOnDefault:!0,defaultValue:void 0};const j=(0,c.V7)(),A=j.searchParams,O=(0,w.useRef)(null!==(t=null===A||void 0===A?void 0:A.get(e))&&void 0!==t?t:null),[_,I]=(0,w.useState)((()=>{var t;const r=function(e){return h.get(e)}(e),n=void 0===r?null!==(t=null===A||void 0===A?void 0:A.get(e))&&void 0!==t?t:null:r;return null===n?null:u(f,n,e)})),P=(0,w.useRef)(_);i("[nuqs `%s`] render - state: %O, iSP: %s",e,_,null!==(r=null===A||void 0===A?void 0:A.get(e))&&void 0!==r?r:null),(0,w.useEffect)((()=>{var t;const r=null!==(t=null===A||void 0===A?void 0:A.get(e))&&void 0!==t?t:null;if(r===O.current)return;const n=null===r?null:u(f,r,e);i("[nuqs `%s`] syncFromUseSearchParams %O",e,n),P.current=n,O.current=r,I(n)}),[null===A||void 0===A?void 0:A.get(e),e]),(0,w.useEffect)((()=>{function t(t){let{state:r,query:n}=t;i("[nuqs `%s`] updateInternalState %O",e,r),P.current=r,O.current=n,I(r)}return i("[nuqs `%s`] subscribing to sync",e),N.on(e,t),()=>{i("[nuqs `%s`] unsubscribing from sync",e),N.off(e,t)}}),[e]);const M=(0,w.useCallback)((function(t){var r,n,c,u,f,w,A,O;let _=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},I=function(e){return"function"===typeof e}(t)?t(null!==(r=null!==(n=P.current)&&void 0!==n?n:x)&&void 0!==r?r:null):t;(null!==(c=_.clearOnDefault)&&void 0!==c?c:b)&&null!==I&&void 0!==x&&v(I,x)&&(I=null);const M=function(e,t,r,n){var a;const s=null===t?null:r(t);return i("[nuqs queue] Enqueueing %s=%s %O",e,s,n),h.set(e,s),"push"===n.history&&(p.history="push"),n.scroll&&(p.scroll=!0),!1===n.shallow&&(p.shallow=!1),n.startTransition&&m.add(n.startTransition),p.throttleMs=Math.max(null!==(a=n.throttleMs)&&void 0!==a?a:d,Number.isFinite(p.throttleMs)?p.throttleMs:0),s}(e,I,g,{history:null!==(u=_.history)&&void 0!==u?u:a,shallow:null!==(f=_.shallow)&&void 0!==f?f:s,scroll:null!==(w=_.scroll)&&void 0!==w?w:l,throttleMs:null!==(A=_.throttleMs)&&void 0!==A?A:o,startTransition:null!==(O=_.startTransition)&&void 0!==O?O:S});return N.emit(e,{state:I,query:M}),y(j)}),[e,a,s,l,o,S,j.updateUrl,j.getSearchParamsSnapshot,j.rateLimitFactor]);return[null!==(n=null!==_&&void 0!==_?_:x)&&void 0!==n?n:null,M]}var j=r(2074),A=r(5449),O=r(3693),_=r(2105),I=r(4414);const P=()=>{const{avatar:e,name:t,description:r,links:a}=O.e.author_settings,l=[{title:"The $60,000 Patch: A Newcomer's One-Week Triumph",created_at:1737423082e3,updated_at:1737457958893,slug:"the_60000_usd_patch_is_a_triumph",summary:"\nIn mid-October, after three rounds of assessments and interviews, I finally get a work from a company that specializing in open-source IoT and embedded development.\n\nAs an application engineer at this company, my responsibilities include building libraries, maintaining product documentation on the wiki, and creating customized demos for various edge computing devices. Just a few days into the role, I learned about a legacy issue with one of the products. Specifically, the RS485 interfaces had a critical flaw that prevented the port from properly switching the data direction.\n\nThe R&D team had previously attempted to address this issue at the application layer by developing a utility tool called `rs485_DE` using C. This tool would open the original RS485 port (e.g., `/dev/ttyAMA2`), then create a new virtual serial port, and monitor data on the virtual port. It would then automatically toggle the chip's $\\overline{\\text{RE}}$ pin based on the data flow direction. However, this approach introduced a new issue: the higher baud rates, the more frequently data loss would occurr. The root cause was the tool's reliance on polling to check the buffers, coupled with the use of the `libgpiod` library to manipulate GPIOs for flow control, which was too slow to meet the performance requirements.\n\nAdding to the complexity, the RS485 transceiver chip used in the product was the TPT7487. On this chip, the $\\overline{\\text{RE}}$ pin is responsible for controlling the chip's mode - either receive or transmit. However, instead of being connected to dedicated DTR pins, the $\\overline{\\text{RE}}$ pin was wired to several general-purpose GPIO pins on the Compute Module 4 (CM4). Unfortunately, the kernel driver did not configure these GPIOs as DTR pins, further limiting the ability to implement a hardware-based solution for automatic data direction control.\n\n![The general-purpose GPIO pins to RS485 transceiver chips](https://assets.n0w0n.com/the_60000_usd_patch_is_a_triumph/1.png)\n![The RS485 transceiver schematic](https://assets.n0w0n.com/the_60000_usd_patch_is_a_triumph/2.png)\n\nAfter thorough discussions and evaluations, the team concluded that replacing all affected products was the only viable solution. Despite the significant cost - an estimated $60,000 - the company prioritized customer satisfaction and product reliability. With no better technical solution available, the recall decision was made to uphold the company's reputation and ensure long-term trust from customers.\n\nOut of curiosity, I requested the schematic of the product and, after some analysis, I surprisingly discovered what I believed could be a potential software solution to the issues. That marked the beginning of a new chapter in addressing the problem.\n\n",words:23012},{title:"MMAP on Allwinner H3 - The faster way to access to GPIO pins",created_at:168455928e4,updated_at:1737457958893,slug:"allwinner_h3_memory_mapping",summary:"\nWhen it comes to control the GPIO pins on a development board, many of developers have tried to access the GPIO pins from the user space (e.g. The `sysfs`). But this approach may not perform well because it's not that fast as you may thought - at least it was vividly reflected in one of my recent needs.\n\nRecently I took over a maker-level project that uses the Raspberry Pi and in the project, the Pi needs to continuously poll the level of a certain output from the FPGA at high speed to determine whether the data is \"ready\". However, as the price of Raspberry Pi rises, I had to consider the affordable alternative, finally I settled on the Orange Pi One, which uses the Allwinner H3 and has a 512 MB of RAM - That's enough for my needs.\n\nIn the original Raspberry Pi implementation for the project, the state of the GPIO pins was obtained directly by accessing the GPIO registers - the memory mapping (mmap), and we know that different SOCs have different internal register sets and addresses, so to port the project to the Allwinner H3, some significant changes in the code were required.\n\nThis article will introduce how I understand the concept of mmap, and how did I analyse the datasheet provided by Allwinner, in the last, I'll provide a complete example of how to use mmap to access GPIO pins in C, Go, and Python.\n\n![Orange Pi One](https://assets.n0w0n.com/allwinner_h3_memory_mapping/1.jpg)\n\n",words:22794}],[o,i]=S("page",{parse:e=>parseInt(e),serialize:e=>e.toString(),defaultValue:1}),c=Math.ceil(l.length/5),u=l.slice(5*(o-1),5*o),d=e=>{e>=1&&e<=c&&i(e)};return(0,I.jsxs)("div",{className:"w-full flex flex-col items-center",children:[(0,I.jsx)("img",{src:e,className:"w-32 rounded-full shadow-xl border-4 border-gray-300 hover:rotate-[360deg] transition-all duration-1000",alt:""}),(0,I.jsx)("h2",{className:"mt-6 text-2xl font-semibold text-gray-800",children:t}),(0,I.jsx)("p",{className:"my-2 text-md text-gray-600",children:r}),(0,I.jsx)("div",{className:"my-2 flex flex-row space-x-4",children:a.map(((e,t)=>{let{link:r,icon:n,name:a}=e;return(0,I.jsx)("a",{href:r,target:"_blank",rel:"noreferrer",children:(0,I.jsx)(s(),{path:n,size:1,className:"text-gray-500 hover:text-amber-600 transition-all"})},"".concat(t,"-").concat(a))}))}),(0,I.jsx)("ul",{className:"flex flex-col animate-fade-up max-w-[calc(80%)] md:max-w-[calc(70%)] lg:max-w-[calc(50%)] my-8 mx-12 lg:mx-0",children:u.length?u.map(((e,t)=>{let{summary:r,title:a,slug:l,created_at:o,updated_at:i,words:c}=e;return(0,I.jsxs)("li",{className:"my-8 space-y-4",children:[(0,I.jsxs)("div",{className:"flex flex-row items-center text-2xl space-x-3 font-extrabold",children:[(0,I.jsx)(s(),{path:n.vZx,size:1,className:"text-gray-500 shrink-0"}),(0,I.jsx)(j.N_,{to:"/post/".concat(l),className:"text-gray-800 hover:text-amber-600 duration-300 transition-all",children:a})]}),(0,I.jsxs)("div",{className:"text-sm text-gray-400 flex flex-col sm:flex-row",children:[(0,I.jsxs)("div",{className:"flex flex-row items-center space-x-1 sm:mr-2",children:[(0,I.jsx)(s(),{path:n.HL7,size:.7,className:""}),(0,I.jsx)("span",{children:(0,_.D)(o)})]}),o!==i&&(0,I.jsxs)("div",{className:"flex flex-row items-center space-x-1 sm:mr-2",children:[(0,I.jsx)(s(),{path:n.rch,size:.7,className:""}),(0,I.jsx)("span",{children:(0,_.D)(i)})]}),(0,I.jsxs)("div",{className:"flex flex-row items-center space-x-1",children:[(0,I.jsx)(s(),{path:n.OKe,size:.7,className:""}),(0,I.jsxs)("span",{children:[c.toLocaleString()," words"]})]})]}),(0,I.jsx)(A.o,{className:"mt-4 pb-4",children:r}),(0,I.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,I.jsx)(j.N_,{to:"/post/".concat(l),className:"text-center duration-300 transition-all border border-gray-300 hover:bg-gray-100 px-4 py-2 rounded-md text-gray-600 hover:text-amber-600",children:"Read more..."}),(0,I.jsx)("hr",{className:"w-full border-gray-300"})]})]},"".concat(t,"-").concat(l))})):(0,I.jsx)("span",{className:"text-center text-gray-600",children:"No posts yet..."})}),l.length>0&&(0,I.jsxs)("div",{className:"flex items-center space-x-4 my-4",children:[(0,I.jsx)("button",{disabled:1===o,onClick:()=>d(o-1),className:"px-4 py-2 rounded-md border border-gray-300 hover:bg-gray-100 text-gray-600 hover:text-amber-600 disabled:opacity-50 transition-all",children:"Previous"}),(0,I.jsxs)("span",{className:"text-gray-600",children:["Page ",o,"/",c]}),(0,I.jsx)("button",{disabled:o===c,onClick:()=>d(o+1),className:"px-4 py-2 rounded-md border border-gray-300 hover:bg-gray-100 text-gray-600 hover:text-amber-600 disabled:opacity-50 transition-all",children:"Next"})]})]})}}}]);